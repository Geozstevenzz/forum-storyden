openapi: 3.0.1

info:
  title: storyden
  version: "1"

servers:
  - url: "/api"

security:
  - cookieAuth: []

paths:
  /version:
    get:
      security: []
      operationId: getVersion
      tags: [misc]
      responses:
        200:
          description: OK
          content:
            text/plain:
              schema:
                type: string
  /openapi.json:
    get:
      security: []
      operationId: getSpec
      tags: [misc]
      responses:
        200:
          description: OK
          content:
            text/plain:
              schema:
                type: string

  /v1/auth/password/signup:
    post:
      operationId: signup
      tags: [auth]
      security: []
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: "#/components/schemas/AuthenticationRequest"
          application/json:
            schema:
              $ref: "#/components/schemas/AuthenticationRequest"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthenticationResponse"
        401:
          description: Unauthorized
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/APIError"

  /v1/auth/password/signin:
    post:
      operationId: signin
      tags: [auth]
      security: []
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: "#/components/schemas/AuthenticationRequest"
          application/json:
            schema:
              $ref: "#/components/schemas/AuthenticationRequest"
      responses:
        200:
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthenticationResponse"
        404:
          description: User not found
        500:
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/APIError"

  # /v1/auth/oauth/{provider}/link:
  #   get:
  #     operationId: oauthLink
  #     security: []
  #     parameters:
  #       - name: provider
  #         in: path
  #         schema:
  #           type: string
  #     responses:
  #       200:
  #         description: OK
  #         content:
  #           application/json:
  #             schema:
  #               $ref: "#/components/schemas/AuthenticationResponse"
  #       404:
  #         description: User not found
  #       500:
  #         description: Internal Server Error
  #         content:
  #           application/json:
  #             schema:
  #               $ref: "#/components/schemas/APIError"

components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: storyden-session

  schemas:
    AuthenticationRequest:
      type: object
      required: [identifier, token]
      properties:
        identifier:
          example: "southclaws@storyden.org"
          type: string
        token:
          example: "password"
          type: string

    AuthenticationResponse:
      type: object
      required: [id]
      properties:
        id:
          type: string

    APIError:
      type: object
      required: [error]
      properties:
        error:
          type: string
        message:
          type: string
        suggested:
          type: string
