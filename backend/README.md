# Server

This directory contains the API codebase. It's written in Go and is fully cross-platform (does not depend on any platform-specific libraries or C code).

For a list of configuration environment variables, see `config.go`. Use an `.env` in development.

## Architecture

### Layout

The codebase follows idiomatic Go guidelines with a sprinkling of DDD. Interfaces are preferred as a means of sharing functionality in order to facilitate easier mocking and testing.

There are three layers with a unidirectional dependency rule.

- transports: the interface layer, where clients communicate with the backend.
- services: the business logic domain.
- resources: the persistence abstraction layer.

Code in the transports layer depends on code in the service layer which depends on code in the resources layer, never the other way around.

### HTTP API

The HTTP transport layer uses OpenAPI to generate the underlying server and data validation code. This is then wired up to the service layer using "bindings".

### Database

The database code is generated by Ent. Migrations are managed via generated sql files using Atlas.

The workflow to make changes to the data model is:

1. Make the change to the model
2. Generate new Go code
3. Generate migrations
4. Apply migrations to dev instance
5. Open pull request
