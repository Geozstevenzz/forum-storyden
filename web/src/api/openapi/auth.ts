/**
 * Generated by orval v6.9.6 🍺
 * Do not edit manually.
 * storyden
 * OpenAPI spec version: 1
 */
import useSwr from "swr";
import type { SWRConfiguration, Key } from "swr";
import type {
  AuthSuccessResponse,
  InternalServerErrorResponse,
  AuthPasswordBody,
  UnauthorisedResponse,
  NotFoundResponse,
  WebAuthnPublicKeyCreationOptionsResponse,
} from "./schemas";
import { fetcher } from "../client";

/**
 * @summary Register a new account with a username and password.
 */
export const authPasswordSignup = (authPasswordBody: AuthPasswordBody) => {
  return fetcher<AuthSuccessResponse>({
    url: `/v1/auth/password/signup`,
    method: "post",
    headers: { "Content-Type": "application/json" },
    data: authPasswordBody,
  });
};

/**
 * @summary Sign in to an existing account with a username and password.
 */
export const authPasswordSignin = (authPasswordBody: AuthPasswordBody) => {
  return fetcher<AuthSuccessResponse>({
    url: `/v1/auth/password/signin`,
    method: "post",
    headers: { "Content-Type": "application/json" },
    data: authPasswordBody,
  });
};

/**
 * @summary Start the WebAuthn registration process by requesting a credential.

 */
export const webAuthnRequestCredential = (accountHandle: string) => {
  return fetcher<WebAuthnPublicKeyCreationOptionsResponse>({
    url: `/v1/auth/webauthn/make/${accountHandle}`,
    method: "post",
  });
};

/**
 * @summary Start the WebAuthn assertion for an existing account.
 */
export const webAuthnGetAssertion = (
  accountHandle: string,
  authPasswordBody: AuthPasswordBody
) => {
  return fetcher<AuthSuccessResponse>({
    url: `/v1/auth/webauthn/assert/${accountHandle}`,
    method: "post",
    headers: { "Content-Type": "application/json" },
    data: authPasswordBody,
  });
};

/**
 * @summary Complete the credential assertion and sign in to an account.
 */
export const webAuthnMakeAssertion = (authPasswordBody: AuthPasswordBody) => {
  return fetcher<AuthSuccessResponse>({
    url: `/v1/auth/webauthn/assert`,
    method: "get",
    headers: { "Content-Type": "application/json" },
  });
};

export const getWebAuthnMakeAssertionKey = (
  authPasswordBody: AuthPasswordBody
) => [`/v1/auth/webauthn/assert`, authPasswordBody];

export type WebAuthnMakeAssertionQueryResult = NonNullable<
  Awaited<ReturnType<typeof webAuthnMakeAssertion>>
>;
export type WebAuthnMakeAssertionQueryError =
  | UnauthorisedResponse
  | NotFoundResponse
  | InternalServerErrorResponse;

export const useWebAuthnMakeAssertion = <
  TError = UnauthorisedResponse | NotFoundResponse | InternalServerErrorResponse
>(
  authPasswordBody: AuthPasswordBody,
  options?: {
    swr?: SWRConfiguration<
      Awaited<ReturnType<typeof webAuthnMakeAssertion>>,
      TError
    > & { swrKey?: Key; enabled?: boolean };
  }
) => {
  const { swr: swrOptions } = options ?? {};

  const isEnabled = swrOptions?.enabled !== false;
  const swrKey =
    swrOptions?.swrKey ??
    (() => (isEnabled ? getWebAuthnMakeAssertionKey(authPasswordBody) : null));
  const swrFn = () => webAuthnMakeAssertion(authPasswordBody);

  const query = useSwr<Awaited<ReturnType<typeof swrFn>>, TError>(
    swrKey,
    swrFn,
    swrOptions
  );

  return {
    swrKey,
    ...query,
  };
};
